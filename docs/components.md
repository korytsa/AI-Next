# Документация компонентов

## Компоненты чата

### ChatPage
**Расположение:** `app/chat/page.tsx`

Главная страница чата, объединяет все компоненты и хуки.

**Основные функции:**
- Управление состоянием чата через `useChat`
- Рендеринг ChatHeader, MessagesList, ChatInput
- Обработка всех действий пользователя

### ChatHeader
**Расположение:** `app/chat/components/ChatHeader.tsx`

Шапка чата с настройками и управлением.

**Props:**
- `useStreaming` - режим streaming
- `onToggleStreaming` - переключение streaming
- `loading` - состояние загрузки
- `onClearHistory` - очистка истории
- `userName` - имя пользователя
- `onEditName` - редактирование имени
- `responseMode` - режим ответа
- `onSetResponseMode` - установка режима
- `onExportDialog` - открытие диалога экспорта
- `totalTokens` - общее количество токенов
- `chainOfThought` - режим Chain of Thought
- `onSetChainOfThought` - установка CoT
- `selectedModel` - выбранная модель
- `onSetSelectedModel` - выбор модели
- `autoPlayVoice` - автовоспроизведение голоса
- `onToggleAutoPlayVoice` - переключение автовоспроизведения
- `useRAG` - использование RAG
- `onToggleUseRAG` - переключение RAG
- `searchQuery` - поисковый запрос
- `onSetSearchQuery` - установка запроса
- `currentInput` - текущий текст в поле ввода
- `onSelectTemplate` - выбор шаблона

**Функции:**
- Отображение заголовка чата
- Кнопка открытия настроек (ChatSettingsDrawer)
- Поиск по истории сообщений
- Отображение количества токенов
- Кнопка очистки истории
- Переключатель языка интерфейса
- Управление именем пользователя

### MessagesList
**Расположение:** `app/chat/components/MessagesList.tsx`

Список сообщений с поддержкой пагинации.

**Props:**
- `messages` - массив сообщений
- `messagesEndRef` - ref для скролла в конец
- `messagesStartRef` - ref для скролла в начало
- `loading` - состояние загрузки
- `onRetry` - повторная отправка
- `autoPlayVoice` - автовоспроизведение
- `isLoadingMore` - загрузка старых сообщений
- `hasMoreMessages` - есть ли еще сообщения
- `loadMoreMessages` - загрузка старых сообщений

**Функции:**
- Отображение списка сообщений
- Пагинация для загрузки старых сообщений
- Автоскролл к новым сообщениям

### MessageBubble
**Расположение:** `app/chat/components/MessageBubble.tsx`

Отдельное сообщение в чате.

**Props:**
- `message` - объект сообщения
- `isLastMessage` - последнее ли это сообщение
- `onRetry` - повторная отправка
- `autoPlayVoice` - автовоспроизведение
- `isLoading` - состояние загрузки

**Функции:**
- Отображение сообщения пользователя или AI
- Рендеринг markdown для ответов AI
- Кнопка остановки голосового воспроизведения
- Кнопка повторной отправки при ошибке

### ChatInput
**Расположение:** `app/chat/components/ChatInput.tsx`

Поле ввода с кнопками управления.

**Props:**
- `input` - значение поля ввода
- `setInput` - установка значения
- `onSubmit` - отправка сообщения
- `loading` - состояние загрузки
- `onCancel` - отмена запроса

**Функции:**
- Текстовый ввод
- Кнопка отправки
- Кнопка отмены
- Интеграция с голосовым вводом
- Кнопка сохранения как шаблон (всегда видна, disabled когда поле пустое)
- Диалог сохранения шаблона

### ChatSettingsDrawer
**Расположение:** `app/chat/components/ChatSettingsDrawer.tsx`

Боковая панель настроек с табами. Открывается по клику на кнопку настроек в ChatHeader.

**Props:**
- `isOpen` - открыта ли панель
- `onClose` - функция закрытия
- `useStreaming` - режим streaming
- `onToggleStreaming` - переключение streaming
- `loading` - состояние загрузки
- `responseMode` - режим ответа (short/detailed)
- `onSetResponseMode` - установка режима
- `chainOfThought` - режим Chain of Thought
- `onSetChainOfThought` - установка CoT
- `selectedModel` - выбранная модель
- `onSetSelectedModel` - выбор модели
- `autoPlayVoice` - автовоспроизведение голоса
- `onToggleAutoPlayVoice` - переключение автовоспроизведения
- `useRAG` - использование RAG
- `onToggleUseRAG` - переключение RAG
- `onExportDialog` - открытие диалога экспорта
- `isExporting` - идет ли экспорт
- `currentInput` - текущий текст в поле ввода
- `onSelectTemplate` - выбор шаблона

**Табы:**
1. **AI Settings** - настройки AI (модель, режим ответа, CoT, streaming, RAG)
2. **Voice** - настройки голоса (автовоспроизведение)
3. **Export** - экспорт чата (txt, markdown, json, pdf)
4. **Templates** - управление шаблонами промптов
5. **Metrics** - метрики использования
6. **Errors** - список ошибок

**Функции:**
- Открытие/закрытие по клику вне панели или Escape
- Переключение между табами
- Управление всеми настройками приложения
- Просмотр метрик и ошибок

### Компоненты настроек (`app/chat/components/settings/`)

#### AISettingsTab
**Расположение:** `app/chat/components/settings/AISettingsTab.tsx`

Таб с настройками AI модели.

**Функции:**
- Выбор модели AI
- Настройка режима ответа (short/detailed)
- Настройка Chain of Thought (none/short/detailed)
- Переключение streaming режима
- Переключение RAG (Retrieval Augmented Generation)

#### VoiceSettingsTab
**Расположение:** `app/chat/components/settings/VoiceSettingsTab.tsx`

Таб с настройками голосового вывода.

**Функции:**
- Переключение автовоспроизведения голоса

#### ExportTab
**Расположение:** `app/chat/components/settings/ExportTab.tsx`

Таб для экспорта истории чата.

**Функции:**
- Экспорт в TXT
- Экспорт в Markdown
- Экспорт в JSON
- Экспорт в PDF
- Индикатор процесса экспорта

#### MetricsTab
**Расположение:** `app/chat/components/settings/MetricsTab.tsx`

Таб с метриками использования API.

**Функции:**
- Фильтрация по периодам (today/week/month/all)
- Отображение статистики:
  - Общее количество запросов
  - Использованные токены
  - Стоимость использования
  - Время ответа (min/avg/max)
  - Статистика по моделям
  - Статистика по endpoints
- Очистка метрик

#### ErrorsTab
**Расположение:** `app/chat/components/settings/ErrorsTab.tsx`

Таб со списком ошибок приложения.

**Функции:**
- Отображение статистики ошибок
- Список всех ошибок с деталями
- Фильтрация по типу ошибки
- Просмотр stack trace
- Очистка ошибок

### PromptTemplates
**Расположение:** `app/chat/components/PromptTemplates.tsx`

Управление шаблонами промптов.

**Props:**
- `onSelectTemplate` - функция выбора шаблона
- `currentInput` - текущий текст в поле ввода
- `showAll` - показывать ли все шаблоны сразу (для таба настроек)

**Функции:**
- Отображение списка шаблонов (все сразу или по клику)
- Создание нового шаблона из текущего текста
- Удаление шаблона
- Использование шаблона (вставка в поле ввода)
- Два режима отображения:
  - Компактный (по клику на кнопку) - для использования в других местах
  - Расширенный (showAll=true) - для таба настроек, показывает все шаблоны сразу

## Общие компоненты

### LanguageSwitcher
**Расположение:** `app/components/LanguageSwitcher.tsx`

Переключатель языка интерфейса.

**Функции:**
- Переключение между русским и английским
- Сохранение выбора в контексте

## Компоненты страниц

### Errors Page
**Расположение:** `app/errors/page.tsx`

**Примечание:** Страница ошибок теперь интегрирована в ChatSettingsDrawer как отдельный таб. Отдельная страница может быть удалена в будущем.

Страница просмотра ошибок (если используется отдельно).

**Компоненты:**
- `ErrorsHeader` - шапка страницы
- `ErrorsList` - список ошибок
- `ErrorCard` - карточка ошибки
- `ErrorsStats` - статистика ошибок
- `EmptyState` - пустое состояние
- `LoadingState` - состояние загрузки

### Metrics Page
**Расположение:** `app/metrics/page.tsx`

**Примечание:** Страница метрик теперь интегрирована в ChatSettingsDrawer как отдельный таб. Отдельная страница может быть удалена в будущем.

Страница метрик использования (если используется отдельно).

**Компоненты:**
- Графики использования токенов
- Статистика запросов
- Стоимость использования
- Время ответа
